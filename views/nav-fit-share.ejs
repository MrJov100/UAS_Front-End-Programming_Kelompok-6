<!DOCTYPE html>
<html lang="en" ng-app="fitShareApp">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style-workout.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/theme.css" />
    <link rel="stylesheet" href="/css/backToTopButton.css" />
    <link rel="stylesheet" href="/css/footer.css" />
    <link rel="stylesheet" href="/css/navbar.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js" referrerpolicy="no-referrer"></script>
    <script src="/scripts/theme-toggle.js"></script>
    <script src="/scripts/backToTopButton.js"></script>
    <script src="/scripts/footer.js"></script>
    <script>
      //angularJS module dan controller
      const app = angular.module("fitShareApp", []);
      app.controller("FitShareController", function ($scope, $http) {
        $scope.uploads = [];
        $scope.showPopupForm = false;
        $scope.editData = {};

        $http.get("/api/uploads").then(
          function (response) {
            $scope.uploads = response.data;
          },
          function (error) {
            console.error("Error fetching uploads data:", error);
          }
        );

        $scope.openEditForm = function (upload) {
          $scope.editData = { ...upload};
          $scope.showEditForm = true;
        }

        $scope.submitEditForm = function () {
          console.log(`Caption yang dikirim:`, $scope.editData.caption);
          if (!$scope.editData.caption || $scope.editData.caption.trim() === '') {
            console.error('Caption is Empty!');
            return;
          }

          $http
            .post(`/api/edit/${$scope.editData.id}`, { caption: $scope.editData.caption })
            .then(
              function (response) {
                const updatedPost = response.data;
                const index = $scope.uploads.findIndex((u) => u.id === updatedPost.id);
                if (index > -1) $scope.uploads[index] = updatedPost;
                $scope.showEditForm = false;
              },
              function (error) {
                console.error("Error updating caption:", error);
              }
            );
        };
      });
    </script>
  </head>
  <body ng-controller="FitShareController">
    <!-- TOMBOL Back to Top -->
    <button id="backToTopBtn" class="back-to-top">
      <img
        src="/assets/images/green-up.png"
        alt="Back to Top"
        id="backToTopImg"
      />
    </button>

    <nav id="navbar">
      <input type="checkbox" id="check" />
      <label for="check" class="checkbtn">
        <i class="fas fa-bars"></i>
      </label>

      <a href="/" id="logo"
        ><img src="/assets/images/logo.png" alt="FitSteps Logo"
      /></a>

      <div class="navbar-biasa">
        <a href="/">Home</a>
        <a href="/fit-share">Fit Share</a>
        <a href="/trendy-shoes">Trendy Shoes</a>
        <a href="/health-benefits">Health Benefits</a>
        <a href="/contact-us">Contact Us</a>
        <a href="/events">Upcoming Events</a>
        <a href="/profile">Profile</a>
        <a href="/logout">Logout</a>

        <!-- Tombol Mode Terang/Gelap -->
        <button id="themeToggleBtn" class="theme-toggle-btn">ðŸŒ™</button>
      </div>

      <a href="/" id="moto"
        ><img src="/assets/images/moto.png" alt="FitSteps Moto"
      /></a>
    </nav>


    <!-- ISI -->

    <div class="content-container">

      <div id="carouselSlidesOnly" class="carousel slide carousel-fade" data-bs-ride="carousel">
        <div class="carousel-inner">
          <div class="carousel-item active">
            <div class="carousel-overlay"></div>
            <img src="/assets/images/fitShare/Carousel-1.jpg" class="d-block w-100" alt="...">
          </div>
          <div class="carousel-item">
            <img src="/assets/images/fitShare/Carousel-2.jpg" class="d-block w-100" alt="...">
          </div>
          <div class="carousel-item">
            <img src="/assets/images/fitShare/Carousel-3.jpg" class="d-block w-100" alt="...">
          </div>
        </div>
        <div class="carousel-text-overlay">
          <h2>Share Your Healthy Lifestyle to FitSteps Community!</h2>
          <p>Inspire others with your commitment to healthy living</p>
        </div>
      </div>

      <div class="post-button">
        <button 
          id="showPopup"
          class="btn btn-primary" 
          type="button" 
          ng-click="showPopupForm = true">+</button>
      </div>

      <div id="popupForm" class="popup-form" ng-show="showPopupForm">
        <div class="popup-content">
          <button 
            id="closePopup" 
            class="close-btn-tutup"
            ng-click="showPopupForm = false">&times;</button>
          <form id="postForm" action="/upload" method="POST" enctype="multipart/form-data">
            <div class="mb-3">
              <label for="imageInput" class="form-label">Unggah Foto</label>
              <input 
                type="file" 
                class="form-control" 
                id="imageInput" 
                name="photo" 
                accept="image/*" 
                required 
              />
            </div>
            <div class="mb-3">
              <label for="captionInput" class="form-label">Caption</label>
              <textarea
                class="form-control" 
                id="captionInput"
                name="caption"
                rows="3"
                placeholder="Tulis caption di sini..."
                required
              ></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
          </form>
        </div>
      </div>

      <div class="edit-popup" ng-if="showEditForm">
        <div class="edit-popup-content">
          <button 
            id="closePopup" 
            class="close-btn-tutup"
            ng-click="showEditForm = false">&times;
          </button>
          <form ng-submit="submitEditForm()">
            <div class="mb-3">
              <label for="editCaptionInput" class="form-label">Edit Caption</label>
              <textarea
                class="form-control"
                name="caption"
                id="editCaptionInput"
                ng-model="editData.caption"
                rows="3"
                required
              ></textarea>
            </div>
            <button type="submit" class="btn btn-success">Update Caption</button>
          </form>
        </div>
      </div>

      <div class="uploads" ng-if="uploads.length > 0">
        <div class="card mb-3" ng-repeat="upload in uploads">
          <img ng-src="/{{upload.photo_url}}" class="card-img-top" alt="Photo"/>
          <div class="card-body">
            <div class="card-body-text">
              <h5 class="card-title">{{upload.nama_lengkap}}</h5>
              <p class="card-text">{{upload.caption}}</p>
            </div>
            <div class="card-body-dropdown">
              <div class="dropdown">
                <button class="btn btn-secondary" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                  â€¢â€¢â€¢
                </button>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="#" ng-click="openEditForm(upload)">Edit</a></li>
                  <li><a class="dropdown-item delete" href="#" style="color: red;">Delete</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <p ng-if="uploads.length === 0" class="text-center mt-4">No one has posted yet, be the first!</p>
    </div>

    <div id="footer-placeholder"></div>

  </body>
</html>
